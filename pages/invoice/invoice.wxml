<!--pages/invoice/invoice.wxml-->
<view class="invoice-page">
  <!-- é¡µé¢å¤´éƒ¨ -->
  <view class="page-header">
    <text class="page-title">å¼€ç¥¨ç”³è¯·</text>
    <text class="page-subtitle">ç”³è¯·å¼€å…·å‘ç¥¨æœåŠ¡</text>
  </view>

  <!-- å‘ç¥¨ç±»å‹é€‰æ‹© -->
  <view class="invoice-types">
    <view class="section-title">å‘ç¥¨ç±»å‹</view>
    <view class="type-list">
      <view 
        class="type-item {{ selectedType === item.id ? 'selected' : '' }}"
        wx:for="{{ invoiceTypes }}"
        wx:key="id"
        bindtap="selectInvoiceType"
        data-id="{{ item.id }}"
      >
        <view class="type-icon">{{ item.icon }}</view>
        <view class="type-info">
          <view class="type-name">{{ item.name }}</view>
          <view class="type-description">{{ item.description }}</view>
          <view class="type-fee">è´¹ç”¨ï¼š{{ item.fee }}</view>
        </view>
        <view class="type-radio {{ selectedType === item.id ? 'selected' : '' }}">
          <view class="radio-inner"></view>
        </view>
      </view>
    </view>
  </view>

  <!-- å¯å¼€ç¥¨é‡‘é¢ -->
  <view class="invoice-amount">
    <view class="section-title">å¯å¼€ç¥¨é‡‘é¢</view>
    <view class="amount-card">
      <view class="amount-info">
        <view class="amount-item">
          <text class="amount-label">æ€»æ¶ˆè´¹é‡‘é¢</text>
          <text class="amount-value">Â¥{{ totalAmount }}</text>
        </view>
        <view class="amount-item">
          <text class="amount-label">å·²å¼€ç¥¨é‡‘é¢</text>
          <text class="amount-value">Â¥{{ invoicedAmount }}</text>
        </view>
        <view class="amount-item highlight">
          <text class="amount-label">å¯å¼€ç¥¨é‡‘é¢</text>
          <text class="amount-value">Â¥{{ availableAmount }}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- å¼€ç¥¨è¡¨å• -->
  <view class="invoice-form" wx:if="{{ selectedType }}">
    <view class="section-title">å¼€ç¥¨ä¿¡æ¯</view>
    
    <!-- å‘ç¥¨é‡‘é¢ -->
    <view class="form-section">
      <view class="form-item">
        <text class="form-label">å¼€ç¥¨é‡‘é¢</text>
        <view class="amount-input-group">
          <text class="currency-symbol">Â¥</text>
          <input 
            class="amount-input"
            type="digit"
            placeholder="0.00"
            value="{{ selectedType === 'personal' ? personalData.amount : companyData.amount }}"
            bindinput="onAmountInput"
          />
        </view>
        <view class="amount-tips">
          <text class="tip-text">å¯å¼€ç¥¨é‡‘é¢ï¼šÂ¥{{ availableAmount }}</text>
          <text class="tip-action" bindtap="setMaxAmount">å…¨éƒ¨å¼€ç¥¨</text>
        </view>
      </view>
    </view>

    <!-- ä¸ªäººå‘ç¥¨è¡¨å• -->
    <view wx:if="{{ selectedType === 'personal' }}" class="form-section">
      <view class="form-item">
        <text class="form-label">å‘ç¥¨æŠ¬å¤´</text>
        <input 
          class="form-input"
          type="text"
          placeholder="è¯·è¾“å…¥å‘ç¥¨æŠ¬å¤´"
          value="{{ personalData.title }}"
          bindinput="onInputChange"
          data-field="title"
        />
      </view>
      
      <view class="form-item">
        <text class="form-label">é‚®ç®±åœ°å€</text>
        <input 
          class="form-input"
          type="text"
          placeholder="è¯·è¾“å…¥é‚®ç®±åœ°å€"
          value="{{ personalData.email }}"
          bindinput="onInputChange"
          data-field="email"
        />
      </view>
    </view>

    <!-- ä¼ä¸šå‘ç¥¨è¡¨å• -->
    <view wx:if="{{ selectedType === 'company' }}" class="form-section">
      <view class="form-item">
        <text class="form-label">ä¼ä¸šåç§°</text>
        <input 
          class="form-input"
          type="text"
          placeholder="è¯·è¾“å…¥ä¼ä¸šåç§°"
          value="{{ companyData.companyName }}"
          bindinput="onInputChange"
          data-field="companyName"
        />
      </view>
      
      <view class="form-item">
        <text class="form-label">çº³ç¨äººè¯†åˆ«å·</text>
        <input 
          class="form-input"
          type="text"
          placeholder="è¯·è¾“å…¥çº³ç¨äººè¯†åˆ«å·"
          value="{{ companyData.taxNumber }}"
          bindinput="onInputChange"
          data-field="taxNumber"
        />
      </view>
      
      <view class="form-item">
        <text class="form-label">ä¼ä¸šåœ°å€</text>
        <input 
          class="form-input"
          type="text"
          placeholder="è¯·è¾“å…¥ä¼ä¸šåœ°å€"
          value="{{ companyData.companyAddress }}"
          bindinput="onInputChange"
          data-field="companyAddress"
        />
      </view>
      
      <view class="form-item">
        <text class="form-label">ä¼ä¸šç”µè¯</text>
        <input 
          class="form-input"
          type="text"
          placeholder="è¯·è¾“å…¥ä¼ä¸šç”µè¯"
          value="{{ companyData.companyPhone }}"
          bindinput="onInputChange"
          data-field="companyPhone"
          maxlength="11"
        />
      </view>
      
      <view class="form-item">
        <text class="form-label">å¼€æˆ·é“¶è¡Œ</text>
        <input 
          class="form-input"
          type="text"
          placeholder="è¯·è¾“å…¥å¼€æˆ·é“¶è¡Œ"
          value="{{ companyData.bankName }}"
          bindinput="onInputChange"
          data-field="bankName"
        />
      </view>
      
      <view class="form-item">
        <text class="form-label">é“¶è¡Œè´¦å·</text>
        <input 
          class="form-input"
          type="text"
          placeholder="è¯·è¾“å…¥é“¶è¡Œè´¦å·"
          value="{{ companyData.bankAccount }}"
          bindinput="onInputChange"
          data-field="bankAccount"
        />
      </view>
      
      <view class="form-item">
        <text class="form-label">é‚®ç®±åœ°å€</text>
        <input 
          class="form-input"
          type="text"
          placeholder="è¯·è¾“å…¥é‚®ç®±åœ°å€"
          value="{{ companyData.email }}"
          bindinput="onInputChange"
          data-field="email"
        />
      </view>
    </view>

    <!-- å‘ç¥¨å†…å®¹ -->
    <view class="form-section">
      <view class="form-item">
        <text class="form-label">å‘ç¥¨å†…å®¹</text>
        <picker 
          mode="selector"
          range="{{ invoiceContents }}"
          value="{{ selectedType === 'personal' ? personalData.contentIndex : companyData.contentIndex }}"
          bindchange="onContentChange"
        >
          <view class="picker-input">
            {{ invoiceContents[selectedType === 'personal' ? personalData.contentIndex : companyData.contentIndex] || 'è¯·é€‰æ‹©å‘ç¥¨å†…å®¹' }}
          </view>
        </picker>
      </view>
    </view>

    <!-- æ”¶ç¥¨ä¿¡æ¯ -->
    <view class="form-section">
      <view class="form-item">
        <text class="form-label">æ”¶ç¥¨äººå§“å</text>
        <input 
          class="form-input"
          type="text"
          placeholder="è¯·è¾“å…¥æ”¶ç¥¨äººå§“å"
          value="{{ selectedType === 'personal' ? personalData.receiverName : companyData.receiverName }}"
          bindinput="onInputChange"
          data-field="receiverName"
        />
      </view>
      
      <view class="form-item">
        <text class="form-label">æ”¶ç¥¨äººç”µè¯</text>
        <input 
          class="form-input"
          type="text"
          placeholder="è¯·è¾“å…¥æ”¶ç¥¨äººç”µè¯"
          value="{{ selectedType === 'personal' ? personalData.receiverPhone : companyData.receiverPhone }}"
          bindinput="onInputChange"
          data-field="receiverPhone"
          maxlength="11"
        />
      </view>
      
      <view class="form-item">
        <text class="form-label">æ”¶ç¥¨åœ°å€</text>
        <textarea
          class="form-textarea"
          placeholder="è¯·è¾“å…¥è¯¦ç»†æ”¶ç¥¨åœ°å€"
          value="{{ selectedType === 'personal' ? personalData.receiverAddress : companyData.receiverAddress }}"
          bindinput="onInputChange"
          data-field="receiverAddress"
          maxlength="200"
        ></textarea>
        <view class="input-counter">{{ selectedType === 'personal' ? personalData.receiverAddress.length : companyData.receiverAddress.length }}/200</view>
      </view>
    </view>

    <!-- å¤‡æ³¨ä¿¡æ¯ -->
    <view class="form-section">
      <view class="form-item">
        <text class="form-label">å¤‡æ³¨è¯´æ˜</text>
        <textarea
          class="form-textarea"
          placeholder="å¦‚æœ‰ç‰¹æ®Šéœ€æ±‚è¯·åœ¨æ­¤è¯´æ˜..."
          value="{{ selectedType === 'personal' ? personalData.remark : companyData.remark }}"
          bindinput="onInputChange"
          data-field="remark"
          maxlength="200"
        ></textarea>
        <view class="input-counter">{{ selectedType === 'personal' ? personalData.remark.length : companyData.remark.length }}/200</view>
      </view>
    </view>
  </view>

  <!-- å¼€ç¥¨é¡»çŸ¥ -->
  <view class="invoice-notice">
    <view class="section-title">å¼€ç¥¨é¡»çŸ¥</view>
    <view class="notice-list">
      <view class="notice-item">
        <text class="notice-icon">ğŸ“§</text>
        <text class="notice-text">ç”µå­å‘ç¥¨å°†åœ¨3-5ä¸ªå·¥ä½œæ—¥å†…å¼€å…·å¹¶å‘é€è‡³é‚®ç®±</text>
      </view>
      <view class="notice-item">
        <text class="notice-icon">ğŸ’³</text>
        <text class="notice-text">ä¸ªäººå‘ç¥¨å’Œä¼ä¸šå‘ç¥¨å‡ä¸ºç”µå­å‘ç¥¨ï¼Œå…è´¹å¼€å…·</text>
      </view>
      <view class="notice-item">
        <text class="notice-icon">ğŸ¢</text>
        <text class="notice-text">ä¼ä¸šå‘ç¥¨å¯ç”¨äºç¨åŠ¡æŠµæ‰£ï¼Œè¯·ç¡®ä¿ä¿¡æ¯å‡†ç¡®</text>
      </view>
      <view class="notice-item">
        <text class="notice-icon">ğŸ“</text>
        <text class="notice-text">å¦‚æœ‰ç–‘é—®è¯·è”ç³»å®¢æœï¼š400-123-4567</text>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨æ“ä½œ -->
  <view class="bottom-actions">
    <button class="action-button secondary" bindtap="contactService">
      è”ç³»å®¢æœ
    </button>
    <button 
      class="action-button primary" 
      disabled="{{ !canSubmit }}"
      bindtap="submitInvoice"
    >
      æäº¤ç”³è¯·
    </button>
  </view>
</view>