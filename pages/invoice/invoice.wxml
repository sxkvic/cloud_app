<!--pages/invoice/invoice.wxml-->

<!-- 顶部蓝色装饰背景 -->
<view class="blue-header"></view>

<view class="container">
  
  <!-- 骨架屏 -->
  <view wx:if="{{loading}}" class="skeleton-wrapper">
    <view class="skeleton-card info-card-skeleton">
      <view class="skeleton-line skeleton-title"></view>
      <view class="skeleton-line skeleton-desc"></view>
    </view>
    <view class="skeleton-card">
      <view class="skeleton-line skeleton-title"></view>
      <view class="skeleton-line skeleton-input"></view>
      <view class="skeleton-line skeleton-input"></view>
    </view>
  </view>

  <!-- 内容区域 -->
  <view wx:else class="fade-in">

    <!-- 当前客户信息卡片 -->
    <view class="card info-card">
      <view class="info-row">
        <view class="info-item">
          <view class="info-label">客户名称</view>
          <view class="info-value">{{customerInfo.customer.customer_name || '未知'}}</view>
        </view>
        <view class="info-item right-align">
          <view class="info-label">设备信息</view>
          <view class="device-tag">
            {{customerInfo.device_info.device_name || '未绑定'}}
          </view>
        </view>
      </view>
    </view>

    <!-- 开票表单 -->
    <view class="card form-card">
      <view class="form-title">开票信息</view>
      <view class="form-subtitle">请填写真实有效的开票信息</view>
    
      <!-- 抬头类型 -->
      <view class="form-group">
        <view class="label">抬头类型</view>
        <view class="radio-group">
          <view 
            class="radio-item {{ titleType === '2' ? 'selected' : '' }}"
            bindtap="selectTitleType"
            data-type="2"
          >
            <view class="radio-circle {{ titleType === '2' ? 'selected' : '' }}">
              <view class="radio-dot"></view>
            </view>
            <text class="radio-label">个人</text>
          </view>
          <view 
            class="radio-item {{ titleType === '1' ? 'selected' : '' }}"
            bindtap="selectTitleType"
            data-type="1"
          >
            <view class="radio-circle {{ titleType === '1' ? 'selected' : '' }}">
              <view class="radio-dot"></view>
            </view>
            <text class="radio-label">企业</text>
          </view>
        </view>
      </view>

      <!-- 发票抬头 -->
      <view class="form-group">
        <view class="label">发票抬头</view>
        <view class="input-wrapper">
          <input 
            class="weui-input"
            type="text"
            placeholder="{{ titleType === '2' ? '请输入个人姓名' : '请输入企业名称' }}"
            placeholder-class="placeholder-style"
            value="{{ invoiceTitle }}"
            bindinput="onInvoiceTitleInput"
          />
        </view>
      </view>

      <!-- 发票类型 -->
      <view class="form-group">
        <view class="label">发票类型</view>
        <view class="radio-group">
          <view 
            class="radio-item {{ invoiceType === 1 ? 'selected' : '' }}"
            bindtap="selectInvoiceType"
            data-type="1"
          >
            <view class="radio-circle {{ invoiceType === 1 ? 'selected' : '' }}">
              <view class="radio-dot"></view>
            </view>
            <text class="radio-label">普通发票</text>
          </view>
          <view 
            class="radio-item disabled"
            bindtap="selectInvoiceType"
            data-type="2"
          >
            <view class="radio-circle">
              <view class="radio-dot"></view>
            </view>
            <text class="radio-label">专用发票（暂不支持）</text>
          </view>
        </view>
      </view>

      <!-- 统一社会信用代码 -->
      <view class="form-group" wx:if="{{ titleType === '1' }}">
        <view class="label">统一社会信用代码</view>
        <view class="input-wrapper">
          <input 
            class="weui-input"
            type="text"
            placeholder="请输入18位社会信用代码"
            placeholder-class="placeholder-style"
            value="{{ socialCreditCode }}"
            bindinput="onSocialCreditCodeInput"
            maxlength="18"
          />
        </view>
      </view>

      <!-- 接收邮箱 -->
      <view class="form-group">
        <view class="label">接收邮箱</view>
        <view class="input-wrapper">
          <input 
            class="weui-input"
            type="text"
            placeholder="请输入接收邮箱"
            placeholder-class="placeholder-style"
            value="{{ receiveEmail }}"
            bindinput="onReceiveEmailInput"
          />
        </view>
      </view>

      <!-- 企业额外信息 -->
      <view wx:if="{{ titleType === '1' }}">
        <view class="form-group">
          <view class="label">开户银行（选填）</view>
          <view class="input-wrapper">
            <input 
              class="weui-input"
              type="text"
              placeholder="请输入开户银行"
              placeholder-class="placeholder-style"
              value="{{ bankName }}"
              bindinput="onBankNameInput"
            />
          </view>
        </view>

        <view class="form-group">
          <view class="label">银行账号（选填）</view>
          <view class="input-wrapper">
            <input 
              class="weui-input"
              type="text"
              placeholder="请输入银行账号"
              placeholder-class="placeholder-style"
              value="{{ bankAccount }}"
              bindinput="onBankAccountInput"
            />
          </view>
        </view>
      </view>
    </view>

    <!-- 开票须知 -->
    <view class="tips-box">
      <view class="tips-title">开票须知</view>
      <view class="tips-item">• 电子发票将在3-5个工作日内开具并发送至邮箱</view>
      <view class="tips-item">• 个人发票和企业发票均为电子发票，免费开具</view>
      <view class="tips-item">• 企业发票可用于税务抵扣，请确保信息准确</view>
      <view class="tips-item">• 如有疑问请联系客服：4009677726</view>
    </view>

    <!-- 发票历史记录 -->
    <view class="card" wx:if="{{invoiceList.length > 0}}">
      <view class="form-title">历史记录</view>
      <view class="invoice-list">
        <view class="invoice-item" wx:for="{{invoiceList}}" wx:key="id" bindtap="viewInvoice" data-invoice="{{item}}">
          <view class="invoice-info">
            <view class="invoice-title">{{item.invoice_title}}</view>
            <view class="invoice-meta">
              <text class="invoice-no">订单号：{{item.order_no}}</text>
              <text class="invoice-amount">￥{{item.order_amount}}</text>
            </view>
            <view class="invoice-time">{{item.created_at}}</view>
          </view>
          <view class="invoice-status {{item.invoice_status === 2 ? 'completed' : 'pending'}}">
            {{item.invoice_status === 2 ? '已开票' : '开票中'}}
          </view>
        </view>
      </view>
    </view>

  </view>

</view>

<!-- 底部固定按钮 -->
<view class="footer-action safe-area-bottom">
  <button 
    class="btn-submit" 
    hover-class="btn-hover" 
    bindtap="submitInvoice"
    disabled="{{!canSubmit || loading}}"
  >
    <text wx:if="{{loading}}">加载中...</text>
    <text wx:else>保存开票信息</text>
  </button>
</view>