<!--pages/change-transfer/change-transfer.wxml-->
<view class="container">

  <!-- 1. 沉浸式头部 -->
  <view class="header-bg">
    <!-- 状态栏占位 (动态高度) -->
    <view style="height: {{statusBarHeight}}px;"></view>
    
    <!-- 导航栏 (动态高度，对齐胶囊) -->
    <view class="nav-bar" style="height: {{navBarHeight}}px; line-height: {{navBarHeight}}px;">
      <view class="back-btn" bindtap="handleBack">
        <image class="icon-back" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjZmZmZmZmIiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCI+PHBhdGggZD0iTTE1IDE5bC03LTcgNy03Ii8+PC9zdmc+" mode="aspectFit"></image>
      </view>
      <text class="nav-title">变更过户</text>
    </view>

    <!-- 账户信息 -->
    <view class="account-info" wx:if="{{customerInfo && !loading}}">
      <view class="info-left">
        <text class="label">当前户主</text>
        <text class="name">{{customerInfo.customer.customer_name || '未知'}}</text>
      </view>
      <view class="info-right">
        <text class="label">设备信息</text>
        <text class="device">{{customerInfo.device_info.device_name || '未绑定'}}</text>
      </view>
    </view>

    <!-- 加载状态 -->
    <view class="account-info" wx:if="{{loading}}">
      <view class="loading-wrapper">
        <text class="loading-icon">⏳</text>
        <text class="loading-text">正在加载客户信息...</text>
      </view>
    </view>
  </view>

  <!-- 2. 内容区域 (向上浮动) -->
  <view class="content-body">
    
    <!-- 骨架屏 - 加载中显示 -->
    <view wx:if="{{ loading }}" class="skeleton-wrapper">
      <view class="skeleton-card">
        <view class="skeleton-line skeleton-title"></view>
        <view class="skeleton-line skeleton-desc"></view>
        <view class="skeleton-line skeleton-desc"></view>
      </view>
    </view>
    
    <!-- 过户表单 - 数据加载完成后显示 -->
    <view wx:else class="card fade-in">
      <view class="card-title">过户信息</view>
      <view class="card-desc">请填写新户主的真实信息</view>

      <!-- 表单项 -->
      <view class="form-section">
        <view class="form-item">
          <text class="form-label">新户主姓名</text>
          <input 
            class="form-input"
            type="text"
            placeholder="请输入新户主姓名"
            value="{{ formData.customerName }}"
            bindinput="onCustomerNameInput"
          />
        </view>
        
        <view class="form-item">
          <text class="form-label">身份证号</text>
          <input 
            class="form-input"
            type="text"
            placeholder="请输入新户主身份证号"
            value="{{ formData.idNumber }}"
            bindinput="onIdNumberInput"
            maxlength="18"
          />
        </view>
      </view>
    </view>

    <!-- 注意事项 -->
    <view class="tips-box" wx:if="{{!loading}}">
      <view class="tips-title">注意事项</view>
      <view class="tips-item">• 请确保填写信息真实有效，过户后无法撤销</view>
      <view class="tips-item">• 过户需要双方身份证原件和相关费用</view>
      <view class="tips-item">• 过户申请将在3-5个工作日内处理完成</view>
      <view class="tips-item">• 我们会在24小时内联系您确认申请详情</view>
    </view>

  </view>

  <!-- 3. 底部悬浮操作栏 -->
  <view class="footer-bar">
    <view class="footer-content">
      <button 
        class="submit-btn" 
        bindtap="submitTransfer"
        disabled="{{!canSubmit || !customerInfo || loading || submitLoading}}"
        loading="{{submitLoading}}"
      >
        <text wx:if="{{submitLoading}}">提交中...</text>
        <text wx:elif="{{loading}}">加载中...</text>
        <text wx:elif="{{!customerInfo}}">客户信息加载失败</text>
        <text wx:else>提交过户申请</text>
      </button>
    </view>
  </view>

</view>