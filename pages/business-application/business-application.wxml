<!--pages/business-application/business-application.wxml-->

<!-- 顶部蓝色装饰背景 -->
<view class="blue-header"></view>

<view class="container">
    
    <!-- 1. 客户类型切换 -->
    <view class="card type-card">
      <view class="type-switch">
        <view class="type-item {{ formData.user_type === 1 ? 'active' : '' }}" 
              bindtap="switchUserType" data-type="1">个人客户</view>
        <view class="type-item {{ formData.user_type === 2 ? 'active' : '' }}" 
              bindtap="switchUserType" data-type="2">企业客户</view>
      </view>
    </view>

    <!-- 2. 基本信息 -->
    <view class="card">
      <view class="form-title">基本信息</view>
      <view class="form-subtitle">请填写真实有效的{{ formData.user_type === 1 ? '身份' : '企业' }}信息</view>
      
      <view class="form-group">
        <view class="label">客户名称</view>
        <view class="input-wrapper">
          <input 
            class="weui-input" 
            type="text"
            placeholder="{{ formData.user_type === 1 ? '请输入真实姓名' : '请输入企业全称' }}" 
            placeholder-class="placeholder-style"
            value="{{ formData.customer_name }}"
            bindinput="onCustomerNameInput"
            maxlength="100"
          />
        </view>
      </view>

      <view class="form-group">
        <view class="label">证件号码</view>
        <view class="input-wrapper">
          <input 
            class="weui-input" 
            type="idcard"
            placeholder="{{ formData.user_type === 1 ? '身份证号' : '统一社会信用代码' }}" 
            placeholder-class="placeholder-style"
            value="{{ formData.id_number }}"
            bindinput="onIdNumberInput"
            maxlength="{{ formData.user_type === 1 ? 18 : 50 }}"
          />
        </view>
      </view>
    </view>

    <!-- 3. 联系信息 -->
    <view class="card">
      <view class="form-title">联系信息</view>
      <view class="form-subtitle">请留下您的联系方式，方便我们与您沟通</view>
      
      <view class="form-group">
        <view class="label">联系人</view>
        <view class="input-wrapper">
          <input 
            class="weui-input" 
            type="text"
            placeholder="请输入联系人姓名" 
            placeholder-class="placeholder-style"
            value="{{ formData.contact_person }}"
            bindinput="onContactPersonInput"
          />
        </view>
      </view>

      <view class="form-group">
        <view class="label">联系电话</view>
        <view class="input-wrapper">
          <input 
            class="weui-input" 
            type="number"
            placeholder="请输入手机号码" 
            placeholder-class="placeholder-style"
            maxlength="11"
            value="{{ formData.contact_phone }}"
            bindinput="onContactPhoneInput"
          />
        </view>
      </view>
    </view>

    <!-- 4. 安装信息 -->
    <view class="card">
      <view class="form-title">安装地址</view>
      <view class="form-subtitle">请提供准确的安装地址信息</view>
      
      <view class="form-group">
        <view class="label">所在城市</view>
        <view class="input-wrapper picker-wrapper" bindtap="showAreaPicker">
          <view class="{{ formData.city ? 'picker-value' : 'placeholder-style' }}">
            {{ formData.city || '请选择省市区' }}
          </view>
          <view class="arrow"></view>
        </view>
      </view>

      <view class="form-group">
        <view class="label">详细地址</view>
        <view class="input-wrapper">
          <input 
            class="weui-input" 
            type="text"
            placeholder="街道、小区、楼号、门牌号" 
            placeholder-class="placeholder-style"
            value="{{ formData.install_address }}"
            bindinput="onInstallAddressInput"
          />
        </view>
      </view>

      <view class="form-group">
        <view class="label">安装要求</view>
        <view class="textarea-wrapper">
          <textarea 
            class="weui-textarea" 
            placeholder="例如：需要在周末安装，请提前电话联系..." 
            placeholder-class="placeholder-style"
            value="{{ formData.install_requirement }}"
            bindinput="onInstallRequirementInput"
            auto-height
            style="min-height: 120rpx;"
            maxlength="200"
          ></textarea>
          <view class="char-count">{{ formData.install_requirement.length }}/200</view>
        </view>
      </view>
    </view>

    <!-- 省份选择器 -->
    <van-popup show="{{ showProvincePicker }}" position="bottom" bind:close="onProvincePickerClose">
      <van-picker
        show-toolbar
        title="选择省份"
        columns="{{ provinceColumns }}"
        bind:confirm="onProvinceConfirm"
        bind:cancel="onProvincePickerClose"
      />
    </van-popup>

    <!-- 城市选择器 -->
    <van-popup show="{{ showCityPicker }}" position="bottom" bind:close="onCityPickerClose">
      <van-picker
        show-toolbar
        title="选择城市"
        columns="{{ cityColumns }}"
        bind:confirm="onCityConfirm"
        bind:cancel="onCityPickerClose"
      />
    </van-popup>

    <!-- 注意事项 -->
    <view class="notes-section">
      <view class="notes-header">
        <view class="icon-info">!</view>
        <text>注意事项</text>
      </view>
      <view class="notes-list">
        <view class="note-item">请确保填写信息真实有效，提交后无法撤销。</view>
        <view class="note-item">我们会在24小时内联系您确认申请详情，请保持电话畅通。</view>
        <view class="note-item">专业团队将在3-5个工作日内上门安装服务。</view>
        <view class="note-item">如有疑问，请拨打客服热线：4009677726。</view>
      </view>
    </view>


</view>

<!-- 底部固定按钮 -->
<view class="footer-action safe-area-bottom">
  <button 
    class="btn-submit" 
    hover-class="btn-hover" 
    bindtap="submitApplication"
    disabled="{{ !canSubmit || submitLoading }}"
    loading="{{ submitLoading }}"
  >
    <text wx:if="{{ submitLoading }}">提交中...</text>
    <text wx:else>提交业务申请</text>
  </button>
</view>