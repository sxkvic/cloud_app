<!--pages/pre-recharge/pre-recharge.wxml-->
<view class="pre-recharge-page">
  <!-- 头部标题 -->
  <view class="page-header">
    <text class="page-title">账户充值</text>
    <text class="page-subtitle">为您的宽带账户充值</text>
  </view>

  <!-- 主体内容 -->
  <view class="main-content">
    <!-- 加载状态 -->
    <view class="loading-section" wx:if="{{isLoadingCustomer}}">
      <view class="loading-card">
        <view class="loading-icon">⏳</view>
        <text class="loading-text">正在加载客户信息...</text>
      </view>
    </view>

    <!-- 充值金额选择 -->
    <view class="amount-section">
      <view class="section-title">选择充值金额</view>
      <view class="amount-grid">
        <view 
          class="amount-item {{selectedAmount == item ? 'selected' : ''}}"
          wx:for="{{quickAmounts}}" 
          wx:key="*this"
          bindtap="selectQuickAmount"
          data-amount="{{item}}"
        >
          <text class="amount-value">¥{{item}}</text>
          <text class="amount-label" wx:if="{{item >= 200}}">送{{item >= 500 ? '50' : item >= 200 ? '20' : '10'}}元</text>
        </view>
      </view>

      <!-- 自定义金额 -->
      <view class="custom-amount-section">
        <view class="custom-title">自定义金额</view>
        <view class="amount-input-wrapper">
          <text class="currency-symbol">¥</text>
          <input
            class="amount-input"
            type="digit"
            placeholder="0.00"
            value="{{rechargeAmount}}"
            bindinput="onAmountInput"
          />
        </view>
      </view>
    </view>

    <!-- 支付方式 -->
    <view class="payment-section">
      <view class="section-title">支付方式</view>
      <view class="payment-methods">
        <view 
          class="payment-method {{paymentMethod == item.value ? 'selected' : ''}}"
          wx:for="{{paymentMethods}}" 
          wx:key="value"
          bindtap="selectPaymentMethod"
          data-type="{{item.value}}"
        >
          <view class="payment-icon">
            <view class="icon-wrapper">
              <text class="payment-emoji" wx:if="{{item.value == '1'}}">💳</text>
              <text class="payment-emoji" wx:if="{{item.value == '2'}}">📱</text>
            </view>
          </view>
          <view class="payment-info">
            <text class="payment-name">{{item.label}}</text>
            <text class="payment-desc">{{item.desc}}</text>
          </view>
          <view class="payment-check">
            <view class="check-icon {{paymentMethod == item.value ? 'checked' : ''}}">✓</view>
          </view>
        </view>
      </view>
    </view>

    <!-- 备注信息 -->
    <view class="remark-section">
      <view class="section-title">备注信息（可选）</view>
      <textarea
        class="remark-input"
        placeholder="请输入备注信息"
        value="{{remark}}"
        bindinput="onRemarkInput"
        maxlength="100"
      />
    </view>
  </view>

  <!-- 底部充值按钮 -->
  <view class="bottom-action">
    <view class="recharge-summary" wx:if="{{rechargeAmount}}">
      <text class="summary-text">充值金额：¥{{rechargeAmount}}</text>
    </view>
    <button 
      class="recharge-btn {{!rechargeAmount || !customerInfo || isLoadingCustomer ? 'disabled' : ''}} {{isLoading ? 'loading' : ''}}" 
      bindtap="createRechargeOrder"
      disabled="{{!rechargeAmount || !customerInfo || isLoading || isLoadingCustomer}}"
    >
      <text wx:if="{{isLoading}}">处理中...</text>
      <text wx:elif="{{isLoadingCustomer}}">加载中...</text>
      <text wx:elif="{{!customerInfo}}">客户信息加载失败</text>
      <text wx:else>立即充值</text>
    </button>
  </view>
</view>