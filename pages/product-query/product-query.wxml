<!--pages/product-query/product-query.wxml-->
<view class="container">

  <!-- 1. é¡¶éƒ¨æœç´¢æ  (å¸é¡¶) -->
  <view class="header-section">
    <!-- çŠ¶æ€æ å ä½ -->
    <view style="height: {{statusBarHeight}}px;"></view>
    
    <!-- æ ‡é¢˜è¡Œ -->
    <view class="nav-bar">
      <view class="back-btn" bindtap="handleBack">
        <image class="icon-back" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjZmZmZmZmIiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCI+PHBhdGggZD0iTTE1IDE5bC03LTcgNy03Ii8+PC9zdmc+"></image>
      </view>
      <text class="nav-title">äº§å“æŸ¥è¯¢</text>
      <view class="nav-placeholder"></view>
    </view>

    <!-- æœç´¢æ¡† -->
    <view class="search-wrapper">
      <view class="search-box">
        <image class="icon-search" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjOUNBM0FGIiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCI+PHBhdGggZD0iTTIxIDIxbC02LTZtMi01YTcgNyAwIDExLTE0IDAgNyA3IDAgMDExNCAweiIvPjwvc3ZnPg=="></image>
        <input class="search-input" placeholder="è¯·è¾“å…¥è®¾å¤‡ç ..." placeholder-class="placeholder" value="{{queryInput}}" bindinput="onInputChange" confirm-type="search" bindconfirm="onSubmit" />
        <view class="divider"></view>
        <view class="search-btn" bindtap="onSubmit">
          <text wx:if="{{isLoading}}" class="loading-icon">âŸ³</text>
          <text wx:else>æœç´¢</text>
        </view>
      </view>
    </view>
  </view>

  <!-- 2. ç»Ÿè®¡æ¡ -->
  <view class="stats-bar" wx:if="{{showResult}}">
    <text class="stats-text">å…± {{queryResult ? queryResult.total : 0}} æ¡è®°å½•</text>
    <view class="tag-update">å®æ—¶æ•°æ®</view>
  </view>

  <!-- éª¨æ¶å± - æœç´¢åŠ è½½ä¸­æ˜¾ç¤º -->
  <view class="skeleton-wrapper" wx:if="{{isLoading}}">
    <!-- ç»Ÿè®¡æ¡éª¨æ¶å± -->
    <view class="stats-bar skeleton-stats-bar">
      <view class="skeleton-line skeleton-stats-text"></view>
    </view>

    <!-- è®¾å¤‡å¡ç‰‡éª¨æ¶å± -->
    <view class="list-container">
      <view class="card skeleton-card" wx:for="{{[1,2,3]}}" wx:key="*this">
        <view class="status-stripe bg-skeleton"></view>
        <view class="card-body">
          <!-- å¤´éƒ¨éª¨æ¶å± -->
          <view class="card-header">
            <view class="header-left">
              <view class="skeleton-line skeleton-device-name"></view>
            </view>
            <view class="header-right">
              <view class="skeleton-line skeleton-price"></view>
            </view>
          </view>

          <!-- æ ¸å¿ƒæ•°æ®åŒºéª¨æ¶å± -->
          <view class="core-data-box">
            <view class="skeleton-line skeleton-sn"></view>
            <view class="skeleton-line skeleton-spec"></view>
            <view class="skeleton-line skeleton-time"></view>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- 3. è®¾å¤‡åˆ—è¡¨ -->
  <view class="list-container" wx:if="{{showResult && queryResult && !isLoading}}">
    <block wx:for="{{queryResult.data}}" wx:key="id">
      
      <view class="card">
        <!-- é¡¶éƒ¨å½©è‰²æ¡ (æ ¹æ®çŠ¶æ€å˜è‰²) -->
        <view class="status-stripe {{item.status === '2' ? 'bg-green' : 'bg-orange'}}"></view>
        
        <view class="card-body">
          <!-- å¤´éƒ¨ä¿¡æ¯ -->
          <view class="card-header">
            <view class="header-left">
              <view class="title-row">
                <text class="device-name">{{item.device_name || item.created_by_username || 'æœªå‘½åè®¾å¤‡'}}</text>
                <view class="status-tag {{item.status === '2' ? 'tag-using' : 'tag-pending'}}">
                  {{item.status == '2' ? 'è¿è¡Œä¸­' : 'å¾…åˆ†é…'}}
                </view>
              </view>
            </view>
            <view class="header-right">
              <view class="price-box">
                <text class="currency">Â¥</text>
                <text class="amount">{{item.amount || '0.00'}}</text>
              </view>
            </view>
          </view>

          <!-- æ ¸å¿ƒæ•°æ®åŒº (ç°è‰²èƒŒæ™¯) -->
          <view class="core-data-box">
            <view class="grid-layout">
              <!-- SN ç  -->
              <view class="grid-item col-span-2">
                <text class="label">è®¾å¤‡ç¼–å· (SN)</text>
                <view class="sn-row">
                  <text class="value-mono">{{item.device_no}}</text>
                  <view class="copy-btn" bindtap="handleCopy" data-text="{{item.device_no}}">
                    <image class="icon-copy" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjNDc3MkZGIiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCI+PHBhdGggZD0iTTggMTZINmEyIDIgMCAwMS0yLTJWNmEyIDIgMCAwMTItMmg4YTIgMiAwIDAxMiAydjJtLTYgMTJoOGEyIDIgMCAwMDItMnYtOGEyIDIgMCAwMC0yLTJoLThhMiAyIDAgMDAtMiAydjhhMiAyIDAgMDAyIDJ6Ii8+PC9zdmc+"></image>
                    <text>å¤åˆ¶</text>
                  </view>
                </view>
              </view>
              
              <!-- è§„æ ¼ -->
              <view class="grid-item">
                <text class="label">è§„æ ¼é…ç½®</text>
                <text class="value">{{item.specification || '-'}}</text>
              </view>
              
              <!-- æ—¶é—´ -->
              <view class="grid-item">
                <text class="label">åˆ›å»ºæ—¶é—´</text>
                <text class="value">{{item.created_at || '-'}}</text>
              </view>
            </view>

            <!-- é¢å¤–ä¿¡æ¯ -->
            <view class="extra-info" wx:if="{{item.description || item.created_by_username}}">
              <view class="grid-layout">
                <view class="grid-item col-span-2" wx:if="{{item.created_by_username}}">
                  <text class="label">åˆ›å»ºäºº</text>
                  <text class="value">{{item.created_by_username}}</text>
                </view>
                <view class="grid-item col-span-2" wx:if="{{item.description}}">
                  <text class="label">å¤‡æ³¨è¯´æ˜</text>
                  <view class="remark-box">
                    {{item.description}}
                  </view>
                </view>
              </view>
            </view>
          </view>

        </view>
      </view>

    </block>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{!showResult && !isLoading}}">
    <view class="empty-icon">ğŸ”</view>
    <text class="empty-text">è¯·è¾“å…¥è®¾å¤‡ç¼–å·æˆ–å®½å¸¦è´¦å·è¿›è¡ŒæŸ¥è¯¢</text>
    <view class="help-link" bindtap="showHelp">
      <text class="help-icon">â“</text>
      å¦‚ä½•æ‰¾åˆ°æˆ‘çš„è®¾å¤‡ç ï¼Ÿ
    </view>
  </view>
</view>