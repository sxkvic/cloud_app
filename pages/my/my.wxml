<!--pages/my/my.wxml-->

<!-- 顶部蓝色装饰背景 -->
<view class="blue-header"></view>

<view class="container">
  
  <!-- 设备信息卡片 -->
  <view class="card info-card fade-in" wx:if="{{ !loading }}">
    <view class="info-row">
      <view class="info-item">
        <view class="info-label">设备名称</view>
        <view class="info-value">{{ deviceInfo.device_name || '未知设备' }}</view>
      </view>
      <view class="info-item right-align">
        <view class="info-label">设备状态</view>
        <view class="device-tag">
          <text class="tag-bold">{{ deviceInfo.status_text || '正常' }}</text>
        </view>
      </view>
    </view>
    <view class="info-row device-no-row">
      <view class="info-item">
        <view class="info-label">设备号</view>
        <view class="info-value device-no">{{ currentDeviceNo || '未知' }}</view>
      </view>
    </view>
  </view>

  <!-- 客户信息卡片 -->
  <view class="card fade-in" wx:if="{{ !loading }}">
    <view class="form-title">客户信息</view>
    <view class="form-subtitle">当前绑定的客户信息</view>
    
    <view class="info-list">
      <view class="info-row-simple">
        <view class="label">客户姓名</view>
        <view class="value">{{ customerInfo.customer_name || '未知' }}</view>
      </view>
      <view class="info-row-simple">
        <view class="label">联系电话</view>
        <view class="value">{{ customerInfo.contact_phone || '未知' }}</view>
      </view>
      <view class="info-row-simple">
        <view class="label">安装地址</view>
        <view class="value">{{ customerInfo.install_address || '未知' }}</view>
      </view>
    </view>
  </view>

  <!-- 功能菜单卡片 -->
  <view class="card fade-in" wx:if="{{ !loading }}">
    <view class="form-title">功能菜单</view>
    
    <view class="menu-list">
      <view class="menu-item" bindtap="navigateToService" data-url="/pages/my-bill/my-bill">
        <view class="menu-icon">
          <text class="iconfont icon-zhangdan"></text>
        </view>
        <view class="menu-info">
          <view class="menu-name">我的账单</view>
          <view class="menu-desc">查看账单记录</view>
        </view>
        <view class="menu-arrow">›</view>
      </view>
      
      <view class="menu-item" bindtap="navigateToService" data-url="/pages/self-renewal/self-renewal">
        <view class="menu-icon">
          <text class="iconfont icon-xufei"></text>
        </view>
        <view class="menu-info">
          <view class="menu-name">自助续费</view>
          <view class="menu-desc">续费当前套餐</view>
        </view>
        <view class="menu-arrow">›</view>
      </view>

      <view class="menu-item" bindtap="navigateToService" data-url="/pages/customer-service/customer-service">
        <view class="menu-icon">
          <text class="iconfont icon-kefu"></text>
        </view>
        <view class="menu-info">
          <view class="menu-name">客服中心</view>
          <view class="menu-desc">在线客服咨询</view>
        </view>
        <view class="menu-arrow">›</view>
      </view>

      <button class="menu-item share-button" open-type="share">
        <view class="menu-icon">
          <text class="iconfont icon-fenxiang"></text>
        </view>
        <view class="menu-info">
          <view class="menu-name">分享应用</view>
          <view class="menu-desc">分享给好友</view>
        </view>
        <view class="menu-arrow">›</view>
      </button>
    </view>
  </view>

  <!-- 设置卡片 -->
  <view class="card fade-in" wx:if="{{ !loading }}">
    <view class="form-title">设置</view>
    
    <view class="menu-list">
      <view class="menu-item" bindtap="rebindDevice">
        <view class="menu-icon">
          <text class="iconfont icon-guohu"></text>
        </view>
        <view class="menu-info">
          <view class="menu-name">重新绑定设备</view>
          <view class="menu-desc">更换设备绑定</view>
        </view>
        <view class="menu-arrow">›</view>
      </view>

      <view class="menu-item" bindtap="showAboutInfo">
        <view class="menu-icon">
          <text class="iconfont icon-guanyu"></text>
        </view>
        <view class="menu-info">
          <view class="menu-name">关于我们</view>
          <view class="menu-desc">应用版本信息</view>
        </view>
        <view class="menu-arrow">›</view>
      </view>
    </view>
  </view>

  <!-- 骨架屏 -->
  <view class="skeleton-wrapper" wx:if="{{ loading }}">
    <view class="skeleton-card info-card-skeleton">
      <view class="skeleton-line skeleton-title"></view>
      <view class="skeleton-line skeleton-desc"></view>
    </view>
    <view class="skeleton-card">
      <view class="skeleton-line skeleton-title"></view>
      <view class="skeleton-line skeleton-input"></view>
      <view class="skeleton-line skeleton-input"></view>
    </view>
  </view>

</view>

<!-- 设备选择弹窗 -->
<view class="device-modal" wx:if="{{showDeviceModal}}" catchtouchmove="true">
  <view class="modal-mask" bindtap="hideDeviceModal"></view>
  <view class="modal-content">
    <view class="modal-header">
      <view class="modal-title">选择设备</view>
      <view class="modal-subtitle">切换或绑定新设备</view>
    </view>
    
    <!-- 当前设备 -->
    <view class="current-device-section" wx:if="{{currentDeviceNo}}">
      <view class="section-label">当前设备</view>
      <view class="device-card current">
        <view class="device-icon-box">
          <van-icon name="desktop-o" size="24px" color="#2B7FF0" />
        </view>
        <view class="device-info">
          <view class="device-name">{{deviceInfo.device_name || '未命名设备'}}</view>
          <view class="device-code">{{currentDeviceNo}}</view>
        </view>
        <view class="device-status">
          <view class="status-dot"></view>
          <text>使用中</text>
        </view>
      </view>
    </view>
    
    <!-- 其他设备列表 -->
    <view class="other-devices-section" wx:if="{{otherDevices.length > 0}}">
      <view class="section-label">其他设备</view>
      <view class="device-list">
        <view 
          class="device-card" 
          wx:for="{{otherDevices}}" 
          wx:key="index"
          hover-class="device-card-hover"
          bindtap="onSelectDevice"
          data-device="{{item}}"
        >
          <view class="device-icon-box gray">
            <van-icon name="desktop-o" size="24px" color="#999" />
          </view>
          <view class="device-info">
            <view class="device-name">{{item.device_name || item.deviceName || '未命名设备'}}</view>
            <view class="device-code">{{item.deviceCode || item.device_no}}</view>
          </view>
          <view class="switch-arrow">›</view>
        </view>
      </view>
    </view>
    
    <!-- 绑定新设备按钮 -->
    <view class="bind-new-btn" hover-class="bind-new-btn-hover" bindtap="goBindNewDevice">
      <view class="bind-icon-box">
        <van-icon name="plus" size="20px" color="#2B7FF0" />
      </view>
      <text>绑定其他设备码</text>
    </view>
    
    <view class="modal-close" bindtap="hideDeviceModal">取消</view>
  </view>
</view>

<!-- 底部导航栏 -->
<van-tabbar active="{{ 1 }}" bind:change="onTabChange">
  <van-tabbar-item icon="home-o">首页</van-tabbar-item>
  <van-tabbar-item icon="user-o">我的</van-tabbar-item>
</van-tabbar>