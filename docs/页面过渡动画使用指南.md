# 页面过渡动画使用指南

## 功能说明

为小程序添加优雅的页面跳转过渡动画，让页面切换更流畅，提升用户体验。

## 组件特性

✨ **优雅动画** - 旋转圆环 + 云朵图标 + 跳动点
🎨 **毛玻璃效果** - 半透明背景 + 模糊效果
⚡ **性能优化** - CSS3 动画，流畅不卡顿
🔧 **易于集成** - 简单配置即可使用

## 使用步骤

### 1. 在页面 JSON 中注册组件

```json
{
  "usingComponents": {
    "page-transition": "/components/page-transition/page-transition"
  }
}
```

### 2. 在页面 WXML 中添加组件

```xml
<!-- 在页面根节点添加，建议放在最后 -->
<page-transition id="pageTransition" show="{{showTransition}}" text="{{transitionText}}"></page-transition>
```

### 3. 在页面 JS 中初始化数据

```javascript
Page({
  data: {
    showTransition: false,
    transitionText: '加载中...'
  }
})
```

### 4. 使用带动画的跳转方法

#### 方法一：使用工具函数（推荐）

```javascript
const { navigation } = require('../../utils/common');

// 普通跳转
navigation.navigateWithTransition('/pages/detail/detail', {
  text: '正在加载详情...'
});

// 重定向跳转
navigation.navigateWithTransition('/pages/result/result', {
  text: '处理中...',
  redirect: true
});

// Tab切换
navigation.switchTabWithTransition('/pages/home/home', {
  text: '返回首页...'
});
```

#### 方法二：手动控制组件

```javascript
// 显示动画
const transition = this.selectComponent('#pageTransition');
transition.showLoading('加载中...');

// 执行跳转
wx.navigateTo({
  url: '/pages/detail/detail',
  success: () => {
    // 跳转成功后隐藏动画
    setTimeout(() => {
      transition.hideLoading();
    }, 300);
  }
});
```

## 完整示例

### 示例 1：首页跳转到详情页

**pages/home/home.json**
```json
{
  "usingComponents": {
    "page-transition": "/components/page-transition/page-transition"
  }
}
```

**pages/home/home.wxml**
```xml
<view class="container">
  <!-- 页面内容 -->
  <button bindtap="goToDetail">查看详情</button>
  
  <!-- 过渡动画组件 -->
  <page-transition id="pageTransition"></page-transition>
</view>
```

**pages/home/home.js**
```javascript
const { navigation } = require('../../utils/common');

Page({
  data: {},
  
  goToDetail() {
    navigation.navigateWithTransition('/pages/detail/detail', {
      text: '正在加载详情...'
    });
  }
})
```

### 示例 2：列表项点击跳转

```javascript
// 列表项点击事件
onItemClick(e) {
  const id = e.currentTarget.dataset.id;
  
  navigation.navigateWithTransition(`/pages/detail/detail?id=${id}`, {
    text: '加载中...'
  });
}
```

### 示例 3：表单提交后跳转

```javascript
async onSubmit() {
  try {
    // 显示过渡动画
    const transition = this.selectComponent('#pageTransition');
    transition.showLoading('提交中...');
    
    // 提交数据
    await API.submitForm(this.data.formData);
    
    // 提交成功，跳转到结果页
    wx.redirectTo({
      url: '/pages/result/result?status=success',
      success: () => {
        setTimeout(() => {
          transition.hideLoading();
        }, 300);
      }
    });
  } catch (error) {
    // 隐藏动画
    const transition = this.selectComponent('#pageTransition');
    transition.hideLoading();
    
    wx.showToast({
      title: '提交失败',
      icon: 'none'
    });
  }
}
```

## API 说明

### 组件属性

| 属性 | 类型 | 默认值 | 说明 |
|------|------|--------|------|
| show | Boolean | false | 是否显示动画 |
| text | String | '加载中...' | 加载提示文字 |

### 组件方法

| 方法名 | 参数 | 说明 |
|--------|------|------|
| showLoading | text: String | 显示加载动画 |
| hideLoading | - | 隐藏加载动画 |

### 工具函数

| 函数名 | 参数 | 说明 |
|--------|------|------|
| navigateWithTransition | url: String, options: Object | 带动画的普通跳转 |
| switchTabWithTransition | url: String, options: Object | 带动画的Tab切换 |

**options 参数说明：**
- `text`: String - 加载提示文字
- `redirect`: Boolean - 是否使用 redirectTo（默认 false）

## 动画效果说明

### 1. 旋转圆环
- 外圈灰色底色
- 顶部蓝色进度条
- 匀速旋转动画

### 2. 云朵图标
- 渐变蓝色云朵
- 脉冲缩放动画
- 位于圆环中心

### 3. 加载文字
- 灰色文字
- 淡入淡出动画

### 4. 跳动点
- 三个蓝色圆点
- 依次跳动动画
- 错开延迟效果

## 自定义样式

如果需要自定义动画样式，可以修改 `page-transition.wxss` 文件：

```css
/* 修改主题色 */
.spinner-ring {
  border-top-color: #your-color; /* 修改圆环颜色 */
}

.cloud-top,
.cloud-bottom {
  background: linear-gradient(135deg, #your-color1, #your-color2); /* 修改云朵颜色 */
}

/* 修改背景 */
.page-transition {
  background: rgba(0, 0, 0, 0.5); /* 深色背景 */
}
```

## 注意事项

1. **组件 ID 必须为 `pageTransition`**，工具函数依赖此 ID
2. **每个需要过渡动画的页面都要添加组件**
3. **建议在页面 onHide 时隐藏动画**，避免返回时动画还在显示
4. **动画时长约 200-500ms**，不建议设置过长

## 性能优化建议

1. 使用 CSS3 动画而非 JS 动画
2. 避免在动画期间进行复杂计算
3. 合理设置动画延迟时间
4. 及时隐藏动画，释放资源

## 常见问题

### Q: 为什么动画不显示？
A: 检查是否在页面 JSON 中注册了组件，以及组件 ID 是否为 `pageTransition`

### Q: 如何修改动画文字？
A: 使用 `navigateWithTransition` 时传入 `text` 参数，或直接设置组件的 `text` 属性

### Q: 可以自定义动画效果吗？
A: 可以，直接修改 `page-transition.wxss` 中的动画样式

### Q: 动画会影响性能吗？
A: 不会，使用的是 CSS3 硬件加速动画，性能优秀

## 更新日志

### v1.0.0 (2025-11-27)
- ✨ 初始版本发布
- 🎨 旋转圆环 + 云朵图标动画
- 🔧 工具函数封装
- 📝 完整文档
