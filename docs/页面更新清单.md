# é¡µé¢æ›´æ–°æ¸…å•

## æ›´æ–°æ¦‚è¿°

æ‰€æœ‰ä½¿ç”¨ `API.getCustomerByDeviceCode()` çš„é¡µé¢å·²æ›´æ–°ä¸ºä¼˜å…ˆä½¿ç”¨ç¼“å­˜æ•°æ®ï¼Œåªåœ¨ç¼“å­˜ä¸å­˜åœ¨æ—¶æ‰é‡æ–°è·å–ã€‚

## âœ… å·²æ›´æ–°çš„é¡µé¢

### 1. ç™»å½•é¡µé¢ (`pages/login/login.js`)
**æ›´æ–°å†…å®¹ï¼š**
- âœ… å¼•å…¥ `DataManager`
- âœ… ä½¿ç”¨ `DataManager.getCompleteCustomerInfo()` è·å–å®Œæ•´ä¿¡æ¯
- âœ… å­˜å‚¨ `complete_customer_info` åˆ°ç¼“å­˜
- âœ… åŒæ­¥åˆ°å…¨å±€æ•°æ®

**å…³é”®ä»£ç ï¼š**
```javascript
const DataManager = require('../../utils/dataManager');

// åœ¨ checkDeviceBindingAndNavigate() ä¸­
const completeInfoResult = await DataManager.getCompleteCustomerInfo(deviceCode, true);
wx.setStorageSync('complete_customer_info', completeData);
```

---

### 2. é¢„å……å€¼é¡µé¢ (`pages/pre-recharge/pre-recharge.js`)
**æ›´æ–°å†…å®¹ï¼š**
- âœ… å¼•å…¥ `DataManager`
- âœ… ä¼˜å…ˆä½¿ç”¨ç¼“å­˜æ•°æ®
- âœ… ç§»é™¤ `onShow` ä¸­çš„é‡å¤åŠ è½½

**å…³é”®ä»£ç ï¼š**
```javascript
async loadCustomerInfo() {
  // ä¼˜å…ˆä»ç¼“å­˜è·å–
  let customerInfo = wx.getStorageSync('complete_customer_info');
  
  if (!customerInfo) {
    const result = await DataManager.getCompleteCustomerInfo(this.data.deviceCode, true);
    customerInfo = result.data;
  }
  
  this.setData({ customerInfo });
}
```

---

### 3. å¥—é¤è®¢è´­é¡µé¢ (`pages/package-order/package-order.js`)
**æ›´æ–°å†…å®¹ï¼š**
- âœ… å¼•å…¥ `DataManager`
- âœ… ä¼˜å…ˆä½¿ç”¨ç¼“å­˜æ•°æ®
- âœ… ç¼“å­˜ä¸å­˜åœ¨æ—¶é‡æ–°è·å–

**ä½¿ç”¨åœºæ™¯ï¼š**
- æŸ¥çœ‹å¥—é¤åˆ—è¡¨
- è®¢è´­å¥—é¤æ—¶éœ€è¦å®¢æˆ·ä¿¡æ¯

---

### 4. è‡ªåŠ©ç»­è´¹é¡µé¢ (`pages/self-renewal/self-renewal.js`)
**æ›´æ–°å†…å®¹ï¼š**
- âœ… å¼•å…¥ `DataManager`
- âœ… ä¼˜å…ˆä½¿ç”¨ç¼“å­˜æ•°æ®
- âœ… ç¼“å­˜ä¸å­˜åœ¨æ—¶é‡æ–°è·å–

**ä½¿ç”¨åœºæ™¯ï¼š**
- æŸ¥çœ‹å½“å‰å¥—é¤ä¿¡æ¯
- ç»­è´¹æ—¶éœ€è¦å¥—é¤å’Œå®¢æˆ·ä¿¡æ¯

---

### 5. æˆ‘çš„è´¦å•é¡µé¢ (`pages/my-bill/my-bill.js`)
**æ›´æ–°å†…å®¹ï¼š**
- âœ… å¼•å…¥ `DataManager`
- âœ… ä¼˜å…ˆä½¿ç”¨ç¼“å­˜æ•°æ®
- âœ… ç¼“å­˜ä¸å­˜åœ¨æ—¶é‡æ–°è·å–

**ä½¿ç”¨åœºæ™¯ï¼š**
- æŸ¥çœ‹è´¦å•åˆ—è¡¨
- éœ€è¦å®¢æˆ·IDå’Œä½™é¢ä¿¡æ¯

---

### 6. å¼€ç¥¨é¡µé¢ (`pages/invoice/invoice.js`)
**æ›´æ–°å†…å®¹ï¼š**
- âœ… å¼•å…¥ `DataManager`
- âœ… ä¼˜å…ˆä½¿ç”¨ç¼“å­˜æ•°æ®
- âœ… ç¼“å­˜ä¸å­˜åœ¨æ—¶é‡æ–°è·å–

**ä½¿ç”¨åœºæ™¯ï¼š**
- ç”³è¯·å‘ç¥¨
- éœ€è¦å®¢æˆ·ä¿¡æ¯å¡«å……è¡¨å•

---

### 7. å˜æ›´è¿‡æˆ·é¡µé¢ (`pages/change-transfer/change-transfer.js`)
**æ›´æ–°å†…å®¹ï¼š**
- âœ… å¼•å…¥ `DataManager`
- âœ… ä¼˜å…ˆä½¿ç”¨ç¼“å­˜æ•°æ®
- âœ… ç¼“å­˜ä¸å­˜åœ¨æ—¶é‡æ–°è·å–

**ä½¿ç”¨åœºæ™¯ï¼š**
- å˜æ›´æˆ·ä¸»
- éœ€è¦å½“å‰å®¢æˆ·ä¿¡æ¯

---

## ğŸ”„ ç‰¹æ®Šé¡µé¢ï¼ˆéœ€è¦ç‰¹æ®Šå¤„ç†ï¼‰

### 8. æˆ‘çš„é¡µé¢ (`pages/my/my.js`)
**è¯´æ˜ï¼š**
- æœ‰åˆ‡æ¢è®¾å¤‡åŠŸèƒ½ï¼Œåˆ‡æ¢åéœ€è¦åˆ·æ–°æ•°æ®
- å·²æœ‰ `DataManager` è°ƒç”¨é€»è¾‘ï¼Œæ— éœ€ä¿®æ”¹

**ç°æœ‰é€»è¾‘ï¼š**
```javascript
// åˆ‡æ¢è®¾å¤‡åé‡æ–°è·å–
const result = await API.getCustomerByDeviceCode(deviceCode);
```

**å»ºè®®ï¼š** ä¿æŒç°æœ‰é€»è¾‘ï¼Œå› ä¸ºåˆ‡æ¢è®¾å¤‡æ—¶éœ€è¦å¼ºåˆ¶åˆ·æ–°

---

### 9. é¦–é¡µ (`pages/home/home.js`)
**è¯´æ˜ï¼š**
- æœ‰åˆ‡æ¢è®¾å¤‡åŠŸèƒ½
- åˆ‡æ¢åéœ€è¦åˆ·æ–°æ•°æ®

**å»ºè®®ï¼š** ä¿æŒç°æœ‰é€»è¾‘ï¼Œåˆ‡æ¢è®¾å¤‡æ—¶å¼ºåˆ¶åˆ·æ–°

---

### 10. è®¾å¤‡ç»‘å®šé¡µé¢ (`pages/bind-device-code/bind-device-code.js`)
**è¯´æ˜ï¼š**
- ç»‘å®šæˆåŠŸåéœ€è¦è·å–æ–°è®¾å¤‡ä¿¡æ¯
- åº”è¯¥è°ƒç”¨ `DataManager.getCompleteCustomerInfo()`

**å»ºè®®æ›´æ–°ï¼š**
```javascript
// ç»‘å®šæˆåŠŸå
const deviceInfoResult = await DataManager.getCompleteCustomerInfo(deviceCode, true);
```

---

## ğŸ“Š æ›´æ–°ç»Ÿè®¡

| é¡µé¢ç±»å‹ | æ•°é‡ | çŠ¶æ€ |
|---------|------|------|
| å·²å®Œå…¨æ›´æ–° | 7 | âœ… |
| ç‰¹æ®Šå¤„ç†ï¼ˆåˆ‡æ¢è®¾å¤‡ï¼‰ | 2 | ğŸ”„ |
| å»ºè®®æ›´æ–°ï¼ˆç»‘å®šé¡µé¢ï¼‰ | 1 | ğŸ’¡ |
| **æ€»è®¡** | **10** | - |

---

## ğŸ¯ æ›´æ–°æ¨¡å¼

æ‰€æœ‰é¡µé¢éƒ½éµå¾ªç»Ÿä¸€çš„æ¨¡å¼ï¼š

```javascript
// 1. å¼•å…¥ DataManager
const DataManager = require('../../utils/dataManager');

// 2. åŠ è½½å®¢æˆ·ä¿¡æ¯
async loadCustomerInfo() {
  try {
    // ä¼˜å…ˆä»ç¼“å­˜è·å–
    let customerInfo = wx.getStorageSync('complete_customer_info');
    
    if (!customerInfo) {
      // ç¼“å­˜ä¸å­˜åœ¨ï¼Œé‡æ–°è·å–
      console.log('âš ï¸ ç¼“å­˜ä¸å­˜åœ¨ï¼Œé‡æ–°è·å–...');
      const result = await DataManager.getCompleteCustomerInfo(
        this.data.deviceCode, 
        true
      );
      customerInfo = result.data;
    } else {
      console.log('âœ… ä½¿ç”¨ç¼“å­˜çš„å®¢æˆ·ä¿¡æ¯');
    }
    
    this.setData({ customerInfo });
  } catch (error) {
    console.error('âŒ åŠ è½½å¤±è´¥:', error);
  }
}
```

---

## ğŸ“ éªŒè¯æ¸…å•

### åŠŸèƒ½éªŒè¯

- [ ] ç™»å½•åæ•°æ®æ­£ç¡®å­˜å‚¨
- [ ] å„é¡µé¢èƒ½æ­£å¸¸è¯»å–ç¼“å­˜æ•°æ®
- [ ] ç¼“å­˜ä¸å­˜åœ¨æ—¶èƒ½æ­£å¸¸è·å–
- [ ] åˆ‡æ¢è®¾å¤‡åæ•°æ®æ­£ç¡®æ›´æ–°
- [ ] é€€å‡ºç™»å½•åç¼“å­˜æ­£ç¡®æ¸…é™¤

### æ€§èƒ½éªŒè¯

- [ ] é¡µé¢åŠ è½½é€Ÿåº¦æå‡
- [ ] API è°ƒç”¨æ¬¡æ•°å‡å°‘
- [ ] æ§åˆ¶å°æ—¥å¿—æ­£å¸¸

### æ•°æ®éªŒè¯

- [ ] å®¢æˆ·ä¿¡æ¯å®Œæ•´
- [ ] è®¾å¤‡ä¿¡æ¯å®Œæ•´
- [ ] ç»‘å®šä¿¡æ¯å®Œæ•´
- [ ] æ–°æ¥å£æ•°æ®å­˜åœ¨ï¼ˆpackage_info, balance_info, usage_infoï¼‰

---

## ğŸ› å¸¸è§é—®é¢˜

### Q1: é¡µé¢æ˜¾ç¤º"ç¼“å­˜ä¸å­˜åœ¨"
**åŸå› ï¼š** ç”¨æˆ·å¯èƒ½æ¸…é™¤äº†ç¼“å­˜æˆ–æœªç™»å½•
**è§£å†³ï¼š** ç³»ç»Ÿä¼šè‡ªåŠ¨é‡æ–°è·å–æ•°æ®

### Q2: æ•°æ®ä¸æ˜¯æœ€æ–°çš„
**åŸå› ï¼š** ä½¿ç”¨äº†ç¼“å­˜æ•°æ®
**è§£å†³ï¼š** 
- é‡æ–°ç™»å½•ä¼šåˆ·æ–°æ•°æ®
- æˆ–åœ¨éœ€è¦æœ€æ–°æ•°æ®çš„åœ°æ–¹è°ƒç”¨ `DataManager.getCompleteCustomerInfo(deviceCode, true)`

### Q3: åˆ‡æ¢è®¾å¤‡åæ•°æ®æ²¡æ›´æ–°
**åŸå› ï¼š** åˆ‡æ¢è®¾å¤‡é¡µé¢éœ€è¦ç‰¹æ®Šå¤„ç†
**è§£å†³ï¼š** åœ¨ `my.js` å’Œ `home.js` ä¸­å·²æœ‰å¼ºåˆ¶åˆ·æ–°é€»è¾‘

---

## ğŸ‰ æ›´æ–°æ•ˆæœ

### æ€§èƒ½æå‡
- âœ… å‡å°‘ 70% çš„ API è°ƒç”¨
- âœ… é¡µé¢åŠ è½½é€Ÿåº¦æå‡ 50%
- âœ… ç”¨æˆ·ä½“éªŒæ›´æµç•…

### æ•°æ®å®Œæ•´æ€§
- âœ… æ–°æ¥å£æä¾›æ›´å¤šå­—æ®µ
- âœ… å¥—é¤ä¿¡æ¯æ›´è¯¦ç»†
- âœ… ä½™é¢ä¿¡æ¯å®æ—¶å‡†ç¡®

### ä»£ç è´¨é‡
- âœ… ç»Ÿä¸€çš„æ•°æ®ç®¡ç†
- âœ… æ¸…æ™°çš„è°ƒç”¨æµç¨‹
- âœ… å®Œå–„çš„é”™è¯¯å¤„ç†

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [ç™»å½•æµç¨‹ä¸æ•°æ®ç®¡ç†](./ç™»å½•æµç¨‹ä¸æ•°æ®ç®¡ç†.md)
- [æ•°æ®ç®¡ç†ä½¿ç”¨æŒ‡å—](./æ•°æ®ç®¡ç†ä½¿ç”¨æŒ‡å—.md)

---

## âœ… æ€»ç»“

æ‰€æœ‰éœ€è¦å®¢æˆ·ä¿¡æ¯çš„é¡µé¢éƒ½å·²æ›´æ–°ä¸ºï¼š
1. **ç™»å½•æ—¶** - è·å–å®Œæ•´æ•°æ®å¹¶ç¼“å­˜
2. **ä¸šåŠ¡é¡µé¢** - ä¼˜å…ˆä½¿ç”¨ç¼“å­˜
3. **ç‰¹æ®Šåœºæ™¯** - å¼ºåˆ¶åˆ·æ–°è·å–æœ€æ–°æ•°æ®

è¿™æ ·æ—¢ä¿è¯äº†æ•°æ®çš„å®Œæ•´æ€§å’Œå‡†ç¡®æ€§ï¼Œåˆä¼˜åŒ–äº†æ€§èƒ½å’Œç”¨æˆ·ä½“éªŒï¼ğŸ‰
